<!-- 
  19/1/2024
  Consider only using "version" (if at all) and "site code" from here SOFTWARE\Microsoft\SMS\Operations Management\SMS Server Role\%role%.
  You need to look at properties collected from SOFTWARE\Microsoft\SMS\Identification. Ditch any version info because it's too inconsistent.
  Find out common properties of this key.
-->
<ManagementPack ContentReadable="true" SchemaVersion="2.0" OriginalSchemaVersion="1.1"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <Manifest>
    <Identity>
      <ID>TestC.Microsoft.Intune.ConfigurationManager.Monitoring</ID>
      <Version>2024.1.19.1</Version>
    </Identity>
    <Name>TestC.Microsoft.Intune.ConfigurationManager.Monitoring</Name>
    <References>
      <Reference Alias="Windows">
        <ID>Microsoft.Windows.Library</ID>
        <Version>7.5.8501.0</Version>
        <PublicKeyToken>31bf3856ad364e35</PublicKeyToken>
      </Reference>
      <Reference Alias="System">
        <ID>System.Library</ID>
        <Version>7.5.8501.0</Version>
        <PublicKeyToken>31bf3856ad364e35</PublicKeyToken>
      </Reference>
      <Reference Alias="SystemCenter">
        <ID>Microsoft.SystemCenter.Library</ID>
        <Version>7.0.8437.0</Version>
        <PublicKeyToken>31bf3856ad364e35</PublicKeyToken>
      </Reference>
      <Reference Alias="Health">
        <ID>System.Health.Library</ID>
        <Version>7.0.8437.0</Version>
        <PublicKeyToken>31bf3856ad364e35</PublicKeyToken>
      </Reference>
      <Reference Alias="MSIGL">
        <ID>Microsoft.SystemCenter.InstanceGroup.Library</ID>
        <Version>7.5.8501.0</Version>
        <PublicKeyToken>31bf3856ad364e35</PublicKeyToken>
      </Reference>
    </References>
  </Manifest>
  <TypeDefinitions>
    <EntityTypes>
      <ClassTypes>
        <!-- One class to collect all CM server properties.
        There are many site codes and versions for CM servers and roles, to help distinguish these in the console,
        role-related properties have the role prefix.
        I.e. DistributionPointVersion, DistributionPointSiteCode etc. -->
        <ClassType ID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" Accessibility="Public" Abstract="false" Base="Windows!Microsoft.Windows.LocalApplication" Hosted="true" Singleton="false" Extension="false">
          <!-- do we need? -->
          <Property ID="SiteServerSiteName" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="SiteCode" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="SiteServer" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="ParentServer" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="ParentSiteCode" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="SiteVersion" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="DatabaseMachineName" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="DatabaseName" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="DistributionPointSiteCode" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="DistributionPointVersion" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="ManagementPointSiteCode" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="ManagementPointVersion" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="ServiceConnectionPointSiteCode" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="ServiceConnectionPointVersion" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="SoftwareUpdatePointSiteCode" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="SoftwareUpdatePointVersion" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="SRSReportingPointSiteCode" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="SRSReportingPointVersion" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
        </ClassType>
        <!-- Agent class. There is no need to add a prefix here because we have a separate class. -->
        <ClassType ID="TestC.Microsoft.Intune.ConfigurationManager.Class.Client" Accessibility="Public" Abstract="false" Base="Windows!Microsoft.Windows.LocalApplication" Hosted="true" Singleton="false" Extension="false">
          <Property ID="SiteCode" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
          <Property ID="Version" Type="string" AutoIncrement="false" Key="false" CaseSensitive="false" MaxLength="256" MinLength="0" Required="false" Scale="0"/>
        </ClassType>
        <ClassType ID="TestC.Microsoft.Intune.ConfigurationManager.Group.SiteServer" Accessibility="Public" Abstract="false" Base="MSIGL!Microsoft.SystemCenter.InstanceGroup" Hosted="false" Singleton="true" Extension="false" />
        <ClassType ID="TestC.Microsoft.Intune.ConfigurationManager.Group.DistributionPoint" Accessibility="Public" Abstract="false" Base="MSIGL!Microsoft.SystemCenter.InstanceGroup" Hosted="false" Singleton="true" Extension="false" />
        <ClassType ID="TestC.Microsoft.Intune.ConfigurationManager.Group.ManagementPoint" Accessibility="Public" Abstract="false" Base="MSIGL!Microsoft.SystemCenter.InstanceGroup" Hosted="false" Singleton="true" Extension="false" />
      </ClassTypes>
    </EntityTypes>
  </TypeDefinitions>
  <Monitoring>
    <Discoveries>
      <!-- Server discovery -->
      <Discovery ID="TestC.Microsoft.Intune.ConfigurationManager.Discovery.Server" Enabled="true" Target="SystemCenter!Microsoft.SystemCenter.HealthService" ConfirmDelivery="false" Remotable="true" Priority="Normal">
        <Category>Discovery</Category>
        <DiscoveryTypes>
          <DiscoveryClass TypeID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"/>
        </DiscoveryTypes>
        <DataSource ID="DS" TypeID="Windows!Microsoft.Windows.FilteredRegistryDiscoveryProvider">
          <ComputerName>$Target/Host/Property[Type="Windows!Microsoft.Windows.Computer"]/PrincipalName$</ComputerName>
          <RegistryAttributeDefinitions>
            <RegistryAttributeDefinition>
              <AttributeName>IsConfigurationManagerServer</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Operations Management\SMS Server Role</Path>
              <!-- 0=regKey 1=regValue -->
              <PathType>0</PathType>
              <!-- 0=CheckIfExists (Boolean) 1=treat data as (String) 2=treat data as (Integer) -->
              <AttributeType>0</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>SiteServerSiteName</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Identification\Site Name</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>SiteCode</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Identification\Site Code</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>SiteServer</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Identification\Site Server</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>ParentServer</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Identification\Parent Server</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>ParentSiteCode</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Identification\Parent Site Code</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <!-- This value is only found on site servers. You can use it to add group members. -->
              <AttributeName>SiteVersion</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Setup\Full Version</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>DatabaseMachineName</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Identification\DatabaseMachineName</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>DatabaseName</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Identification\DatabaseName</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>DistributionPointSiteCode</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Operations Management\SMS Server Role\SMS Distribution Point\Site Code</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>DistributionPointVersion</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Operations Management\SMS Server Role\SMS Distribution Point\Version</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>ManagementPointSiteCode</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Operations Management\SMS Server Role\SMS Management Point\Site Code</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>ManagementPointVersion</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Operations Management\SMS Server Role\SMS Management Point\Version</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>ServiceConnectionPointSiteCode</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Operations Management\SMS Server Role\SMS Dmp Connector\Site Code</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>ServiceConnectionPointVersion</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Operations Management\SMS Server Role\SMS Dmp Connector\Version</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>SoftwareUpdatePointSiteCode</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Operations Management\SMS Server Role\Software Update Point\Site Code</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>SoftwareUpdatePointVersion</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Operations Management\SMS Server Role\Software Update Point\Version</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>SRSReportingPointSiteCode</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Operations Management\SMS Server Role\SMS SRS Reporting Point\Site Code</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>SRSReportingPointVersion</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Operations Management\SMS Server Role\SMS SRS Reporting Point\Version</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
          </RegistryAttributeDefinitions>
          <!-- 86400 in prod. -->
          <Frequency>60</Frequency>
          <ClassId>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]$</ClassId>
          <InstanceSettings>
            <Settings>
              <Setting>
                <Name>$MPElement[Name="Windows!Microsoft.Windows.Computer"]/PrincipalName$</Name>
                <Value>$Target/Host/Property[Type="Windows!Microsoft.Windows.Computer"]/PrincipalName$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/SiteServerSiteName$</Name>
                <Value>$Data/Values/SiteServerSiteName$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/SiteCode$</Name>
                <Value>$Data/Values/SiteCode$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/SiteServer$</Name>
                <Value>$Data/Values/SiteServer$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/ParentServer$</Name>
                <Value>$Data/Values/ParentServer$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/ParentSiteCode$</Name>
                <Value>$Data/Values/ParentSiteCode$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/SiteVersion$</Name>
                <Value>$Data/Values/SiteVersion$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/DatabaseMachineName$</Name>
                <Value>$Data/Values/DatabaseMachineName$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/DatabaseName$</Name>
                <Value>$Data/Values/DatabaseName$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/DistributionPointSiteCode$</Name>
                <Value>$Data/Values/DistributionPointSiteCode$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/DistributionPointVersion$</Name>
                <Value>$Data/Values/DistributionPointVersion$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/ManagementPointSiteCode$</Name>
                <Value>$Data/Values/ManagementPointSiteCode$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/ManagementPointVersion$</Name>
                <Value>$Data/Values/ManagementPointVersion$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/ServiceConnectionPointSiteCode$</Name>
                <Value>$Data/Values/ServiceConnectionPointSiteCode$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/ServiceConnectionPointVersion$</Name>
                <Value>$Data/Values/ServiceConnectionPointVersion$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/SoftwareUpdatePointSiteCode$</Name>
                <Value>$Data/Values/SoftwareUpdatePointSiteCode$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/SoftwareUpdatePointVersion$</Name>
                <Value>$Data/Values/SoftwareUpdatePointVersion$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/SRSReportingPointSiteCode$</Name>
                <Value>$Data/Values/SRSReportingPointSiteCode$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/SRSReportingPointVersion$</Name>
                <Value>$Data/Values/SRSReportingPointVersion$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="System!System.Entity"]/DisplayName$</Name>
                <Value>$Target/Host/Property[Type="System!System.Entity"]/DisplayName$</Value>
              </Setting>
            </Settings>
          </InstanceSettings>
          <Expression>
            <SimpleExpression>
              <ValueExpression>
                <XPathQuery Type="String">Values/IsConfigurationManagerServer</XPathQuery>
              </ValueExpression>
              <Operator>Equal</Operator>
              <ValueExpression>
                <Value Type="String">True</Value>
              </ValueExpression>
            </SimpleExpression>
          </Expression>
        </DataSource>
      </Discovery>
      <!-- Client discovery -->
      <Discovery ID="TestC.Microsoft.Intune.ConfigurationManager.Discovery.Client" Enabled="true" Target="SystemCenter!Microsoft.SystemCenter.HealthService" ConfirmDelivery="false" Remotable="true" Priority="Normal">
        <Category>Discovery</Category>
        <DiscoveryTypes>
          <DiscoveryClass TypeID="TestC.Microsoft.Intune.ConfigurationManager.Class.Client"/>
        </DiscoveryTypes>
        <DataSource ID="DS" TypeID="Windows!Microsoft.Windows.FilteredRegistryDiscoveryProvider">
          <ComputerName>$Target/Host/Property[Type="Windows!Microsoft.Windows.Computer"]/PrincipalName$</ComputerName>
          <RegistryAttributeDefinitions>
            <RegistryAttributeDefinition>
              <AttributeName>IsConfigurationManagerClient</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Mobile Client</Path>
              <!-- 0=regKey 1=regValue -->
              <PathType>0</PathType>
              <!-- 0=CheckIfExists (Boolean) 1=treat data as (String) 2=treat data as (Integer) -->
              <AttributeType>0</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>SiteCode</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Mobile Client\AssignedSiteCode</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
            <RegistryAttributeDefinition>
              <AttributeName>Version</AttributeName>
              <Path>SOFTWARE\Microsoft\SMS\Mobile Client\SmsClientVersion</Path>
              <PathType>1</PathType>
              <AttributeType>1</AttributeType>
            </RegistryAttributeDefinition>
          </RegistryAttributeDefinitions>
          <!-- 86400 in prod. -->
          <Frequency>60</Frequency>
          <ClassId>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Client"]$</ClassId>
          <InstanceSettings>
            <Settings>
              <Setting>
                <Name>$MPElement[Name="Windows!Microsoft.Windows.Computer"]/PrincipalName$</Name>
                <Value>$Target/Host/Property[Type="Windows!Microsoft.Windows.Computer"]/PrincipalName$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Client"]/SiteCode$</Name>
                <Value>$Data/Values/SiteCode$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Client"]/Version$</Name>
                <Value>$Data/Values/Version$</Value>
              </Setting>
              <Setting>
                <Name>$MPElement[Name="System!System.Entity"]/DisplayName$</Name>
                <Value>$Target/Host/Property[Type="System!System.Entity"]/DisplayName$</Value>
              </Setting>
            </Settings>
          </InstanceSettings>
          <Expression>
            <SimpleExpression>
              <ValueExpression>
                <XPathQuery Type="String">Values/IsConfigurationManagerClient</XPathQuery>
              </ValueExpression>
              <Operator>Equal</Operator>
              <ValueExpression>
                <Value Type="String">True</Value>
              </ValueExpression>
            </SimpleExpression>
          </Expression>
        </DataSource>
      </Discovery>
      <Discovery ID="TestC.Microsoft.Intune.ConfigurationManager.Discovery.SiteServer" Enabled="true" Target="TestC.Microsoft.Intune.ConfigurationManager.Group.SiteServer" ConfirmDelivery="false" Remotable="true" Priority="Normal">
        <Category>Discovery</Category>
        <DiscoveryTypes>
          <DiscoveryRelationship TypeID="MSIGL!Microsoft.SystemCenter.InstanceGroupContainsEntities" />
        </DiscoveryTypes>
        <DataSource ID="GroupPopulationDataSource" TypeID="SystemCenter!Microsoft.SystemCenter.GroupPopulator">
          <RuleId>$MPElement$</RuleId>
          <GroupInstanceId>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Group.SiteServer"]$</GroupInstanceId>
          <MembershipRules>
            <MembershipRule>
              <MonitoringClass>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]$</MonitoringClass>
              <RelationshipClass>$MPElement[Name="MSIGL!Microsoft.SystemCenter.InstanceGroupContainsEntities"]$</RelationshipClass>
              <Expression>
                <RegExExpression>
                  <ValueExpression>
                    <Property>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/SiteVersion$</Property>
                  </ValueExpression>
                  <Operator>MatchesRegularExpression</Operator>
                  <Pattern>.</Pattern>
                </RegExExpression>
              </Expression>
            </MembershipRule>
          </MembershipRules>
        </DataSource>
      </Discovery>
      <Discovery ID="TestC.Microsoft.Intune.ConfigurationManager.Discovery.DistributionPoint" Enabled="true" Target="TestC.Microsoft.Intune.ConfigurationManager.Group.DistributionPoint" ConfirmDelivery="false" Remotable="true" Priority="Normal">
        <Category>Discovery</Category>
        <DiscoveryTypes>
          <DiscoveryRelationship TypeID="MSIGL!Microsoft.SystemCenter.InstanceGroupContainsEntities" />
        </DiscoveryTypes>
        <DataSource ID="GroupPopulationDataSource" TypeID="SystemCenter!Microsoft.SystemCenter.GroupPopulator">
          <RuleId>$MPElement$</RuleId>
          <GroupInstanceId>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Group.DistributionPoint"]$</GroupInstanceId>
          <MembershipRules>
            <MembershipRule>
              <MonitoringClass>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]$</MonitoringClass>
              <RelationshipClass>$MPElement[Name="MSIGL!Microsoft.SystemCenter.InstanceGroupContainsEntities"]$</RelationshipClass>
              <Expression>
                <RegExExpression>
                  <ValueExpression>
                    <Property>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/DistributionPointVersion$</Property>
                  </ValueExpression>
                  <Operator>MatchesRegularExpression</Operator>
                  <Pattern>.</Pattern>
                </RegExExpression>
              </Expression>
            </MembershipRule>
          </MembershipRules>
        </DataSource>
      </Discovery>

      <Discovery ID="TestC.Microsoft.Intune.ConfigurationManager.Discovery.ManagementPoint" Enabled="true" Target="TestC.Microsoft.Intune.ConfigurationManager.Group.ManagementPoint" ConfirmDelivery="false" Remotable="true" Priority="Normal">
        <Category>Discovery</Category>
        <DiscoveryTypes>
          <DiscoveryRelationship TypeID="MSIGL!Microsoft.SystemCenter.InstanceGroupContainsEntities" />
        </DiscoveryTypes>
        <DataSource ID="GroupPopulationDataSource" TypeID="SystemCenter!Microsoft.SystemCenter.GroupPopulator">
          <RuleId>$MPElement$</RuleId>
          <GroupInstanceId>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Group.ManagementPoint"]$</GroupInstanceId>
          <MembershipRules>
            <MembershipRule>
              <MonitoringClass>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]$</MonitoringClass>
              <RelationshipClass>$MPElement[Name="MSIGL!Microsoft.SystemCenter.InstanceGroupContainsEntities"]$</RelationshipClass>
              <Expression>
                <RegExExpression>
                  <ValueExpression>
                    <Property>$MPElement[Name="TestC.Microsoft.Intune.ConfigurationManager.Class.Server"]/ManagementPointVersion$</Property>
                  </ValueExpression>
                  <Operator>MatchesRegularExpression</Operator>
                  <Pattern>.</Pattern>
                </RegExExpression>
              </Expression>
            </MembershipRule>
          </MembershipRules>
        </DataSource>
      </Discovery>

    </Discoveries>

    <Monitors>
      <!-- SMS_SITE_SQL_BACKUP service -->
      <UnitMonitor ID="TestC.Microsoft.Intune.ConfigurationManager.Monitor.SmsSiteSqlBackupService" Accessibility="Public" Enabled="true" Target="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" ParentMonitorID="Health!System.Health.AvailabilityState" Remotable="true" Priority="Normal" TypeID="Windows!Microsoft.Windows.CheckNTServiceStateMonitorType" ConfirmDelivery="false">
        <Category>Alert</Category>
        <AlertSettings AlertMessage="TestC.Microsoft.Intune.ConfigurationManager.Monitor.SmsSiteSqlBackupService.AlertMessage">
          <AlertOnState>Error</AlertOnState>
          <AutoResolve>true</AutoResolve>
          <AlertPriority>Normal</AlertPriority>
          <AlertSeverity>Error</AlertSeverity>
          <AlertParameters>
            <AlertParameter1>$Target/Host/Property[Type="Windows!Microsoft.Windows.Computer"]/PrincipalName$</AlertParameter1>
          </AlertParameters>
        </AlertSettings>
        <OperationalStates>
          <OperationalState ID="Healthy" MonitorTypeStateID="Running" HealthState="Success"/>
          <OperationalState ID="Unhealthy" MonitorTypeStateID="NotRunning" HealthState="Error"/>
        </OperationalStates>
        <Configuration>
          <ComputerName>$Target/Host/Property[Type="Windows!Microsoft.Windows.Computer"]/PrincipalName$</ComputerName>
          <ServiceName>SMS_SITE_SQL_BACKUP</ServiceName>
          <CheckStartupType>true</CheckStartupType>
        </Configuration>
      </UnitMonitor>

    </Monitors>
    <Recoveries>
      <Recovery ID="TestC.Microsoft.Intune.ConfigurationManager.Recovery.SmsSiteSqlBackupService" Accessibility="Public" Enabled="true" Target="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" Monitor="TestC.Microsoft.Intune.ConfigurationManager.Monitor.SmsSiteSqlBackupService" ResetMonitor="true" ExecuteOnState="Error" Remotable="true" Timeout="300">
        <Category>Maintenance</Category>
        <WriteAction ID="WA" TypeID="System!System.CommandExecuter">
          <ApplicationName>%windir%\System32\net.exe</ApplicationName>
          <WorkingDirectory/>
          <CommandLine>start "SMS_SITE_SQL_BACKUP"</CommandLine>
          <TimeoutSeconds>60</TimeoutSeconds>
          <RequireOutput>true</RequireOutput>
        </WriteAction>
      </Recovery>
    </Recoveries>


  </Monitoring>
  <Presentation>
    <StringResources>
      <StringResource ID="TestC.Microsoft.Intune.ConfigurationManager.Monitor.SmsSiteSqlBackupService.AlertMessage"/>
    </StringResources>
  </Presentation>

  <LanguagePacks>
    <LanguagePack ID="ENU" IsDefault="false">
      <DisplayStrings>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Monitoring">
          <Name>Microsoft Configuration Manager</Name>
          <Description></Description>
        </DisplayString>
        <!-- Classes -->
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server">
          <Name>Configuration Manager Server</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="SiteServerSiteName">
          <Name>Site Server Site Name</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="SiteCode">
          <Name>Site Code</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="SiteServer">
          <Name>Site Server</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="ParentServer">
          <Name>Parent Server</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="ParentSiteCode">
          <Name>Parent Site Code</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="SiteVersion">
          <Name>Site Version</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="DatabaseMachineName">
          <Name>Database Server</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="DatabaseName">
          <Name>Database Name</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="DistributionPointSiteCode">
          <Name>Distribution Point Site Code</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="DistributionPointVersion">
          <Name>Distribution Point Version</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="ManagementPointSiteCode">
          <Name>Management Point Site Code</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="ManagementPointVersion">
          <Name>Management Point Version</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="ServiceConnectionPointSiteCode">
          <Name>Service Connection Point Site Code</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="ServiceConnectionPointVersion">
          <Name>Service Connection Point Version</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="SoftwareUpdatePointSiteCode">
          <Name>Software Update Point Site Code</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="SoftwareUpdatePointVersion">
          <Name>Software Update Point Version</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="SRSReportingPointSiteCode">
          <Name>SRS Reporting Point Site Code</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Server" SubElementID="SRSReportingPointVersion">
          <Name>SRS Reporting Point Version</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Client">
          <Name>Configuration Manager Client</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Client" SubElementID="SiteCode">
          <Name>Site Code</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Class.Client" SubElementID="Version">
          <Name>Version</Name>
        </DisplayString>
        <!-- Discoveries -->
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Discovery.Server">
          <Name>Configuration Manager Server Discovery</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Discovery.Client">
          <Name>Configuration Manager Client Discovery</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Discovery.SiteServer">
          <Name>Configuration Manager Site Server Discovery</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Discovery.DistributionPoint">
          <Name>Configuration Manager Distribution Point Discovery</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Discovery.ManagementPoint">
          <Name>Configuration Manager Management Point Discovery</Name>
        </DisplayString>
        <!-- Monitors -->
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Monitor.SmsSiteSqlBackupService">
          <Name>SMS_SITE_SQL_BACKUP Service Monitor</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Monitor.SmsSiteSqlBackupService.AlertMessage">
          <Name>SMS_SITE_SQL_BACKUP Service Not Running</Name>
          <Description>The 'SMS_SITE_SQL_BACKUP' service on {0} is not running.</Description>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Monitor.SmsSiteSqlBackupService" SubElementID="Healthy">
          <Name>Running</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Monitor.SmsSiteSqlBackupService" SubElementID="Unhealthy">
          <Name>Not running</Name>
        </DisplayString>
        <!-- Recoveries -->
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Recovery.SmsSiteSqlBackupService">
          <Name></Name>
          <Description>Start Windows service</Description>
        </DisplayString>
        <!-- Groups -->
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Group.SiteServer">
          <Name>Configuration Manager Site Server</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Group.DistributionPoint">
          <Name>Configuration Manager Distribution Point</Name>
        </DisplayString>
        <DisplayString ElementID="TestC.Microsoft.Intune.ConfigurationManager.Group.ManagementPoint">
          <Name>Configuration Manager Management Point</Name>
        </DisplayString>
      </DisplayStrings>
    </LanguagePack>
  </LanguagePacks>
</ManagementPack>